#!/usr/bin/env ruby

# A utility to help get information about Unity projects
# ---

require 'slop'

opts = Slop.parse do |o|

    #
    # Generate a .gitignore file
    #
    o.on '-gi', '--gen-gitignore', "Generate a .gitignore file in the current directory" do

        gitignore_filename = File.expand_path(".gitignore")

        if File.exists? gitignore_filename
            puts ".gitignore already exists! Aborting..."
            exit 1
        end

        contents = <<EOF
/[Ll]ibrary/
/[Tt]emp/
/[Oo]bj/
/[Bb]uild/
/[Bb]uilds/
/Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
.consulo/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

# Unity3D generated meta files
*.pidb.meta

# Unity3D Generated File On Crash Reports
sysinfo.txt

# Builds
*.apk
*.unitypackage
iOS/

EOF

        File.open(gitignore_filename, "w+") { |f| f.write(contents) }
        exit
    end


    #
    # Get a project's Unity version
    #
    o.on '-v', '--version', "Print the version of the current Unity project" do

        version_filename = "ProjectSettings/ProjectVersion.txt"
        version_file     = File.expand_path(version_filename)

        unless File.exists? version_file
            raise "#{version_filename} doesn't exist in this directory!"
            exit 1
        end

        contents = File.read(version_file)

        puts "Version: " + contents.split("\n").first.chomp.gsub("m_EditorVersion: ", "")

        exit
    end

    o.on '-h', '--help' do
        puts o
        exit
    end
end

puts opts